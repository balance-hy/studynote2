# 微服务保护和分布式事务

## 微服务保护

在微服务远程调用的过程中，还存在几个问题需要解决。

首先是**业务健壮性**问题：

- 例如在之前的查询购物车列表业务中，购物车服务需要查询最新的商品信息，与购物车数据做对比，提醒用户。
- 大家设想一下，如果商品服务查询时发生故障，查询购物车列表在调用商品服务时，是不是也会异常？从而导致购物车查询失败。但从业务角度来说，为了提升用户体验，**即便是商品查询失败，购物车列表也应该正确展示出来，哪怕是不包含最新的商品信**息。

还有**级联**失败（雪崩）问题：

- 还是查询购物车的业务，假如商品服务业务并发较高，占用过多Tomcat连接。可能会导致商品服务的所有接口响应时间增加，延迟变高，甚至是长时间阻塞直至查询失败。
- 此时查询购物车业务需要查询并等待商品查询结果，从而导致查询购物车列表业务的响应时间也变长，甚至也阻塞直至无法访问。而此时如果查询购物车的请求较多，可能导致购物车服务的Tomcat连接占用较多，**所有接口的响应时间都会增加，整个服务性能很差，甚至不可用**。

![image-20240520163512651](http://img.balance.wiki//blog/image-20240520163512651.png)

依次类推，整个微服务群中与购物车服务、商品服务等有调用关系的服务可能都会出现问题，最终导致整个集群不可用。

这就是**级联失败**问题，或者叫**雪崩**问题。

**保证服务运行的健壮性，避免级联失败导致的雪崩问题，就属于微服务保护**。

### 服务保护方案

微服务保护的方案有很多，比如：

- 请求限流
- 线程隔离
- 服务熔断

这些方案或多或少都会导致服务的体验上略有下降。

- **比如请求限流，降低了并发上限；**
- **线程隔离，降低了可用资源数量；**
- **服务熔断，降低了服务的完整度，部分服务变的不可用或弱可用。**

因此这些方案都属于服务**降级**的方案。但通过这些方案，服务的健壮性得到了提升，















































































## 分布式事务

